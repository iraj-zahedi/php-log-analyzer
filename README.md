# تحلیلگر جامع لاگ سرور
ابزاری هوشمند و سبک برای شناسایی حملات، خطاهای سیستمی و رویدادهای امنیتی از طریق تحلیل لاگ‌های سرور لینوکس، نوشته شده با PHP.

این اسکریپت به شما کمک می‌کند تا لاگ‌های مختلف سرور خود را به سادگی تحلیل کرده و گزارش‌های تصویری و قابل فهمی از وضعیت سرور خود دریافت کنید. این ابزار برای مدیران سرور، توسعه‌دهندگان وب و علاقه‌مندان به امنیت طراحی شده است.


**

---

## ✨ ویژگی‌های کلیدی

-   **تحلیل جامع امنیتی:**
    -   **وب‌سرور:** شناسایی حملات رایج مانند SQL Injection, Cross-Site Scripting (XSS) و Path Traversal.
    -   **فایروال وب (WAF):** نمایش لاگ‌های مسدود شده توسط ModSecurity، مانند دسترسی به فایل‌های حساس.
    -   **سرویس‌ها:** تشخیص حملات Brute-Force به سرویس‌های SSH و ایمیل (SMTP/IMAP).

-   **مانیتورینگ سلامت سیستم‌عامل:**
    -   **خطاهای بحرانی:** شناسایی جدی‌ترین خطاهای کرنل مانند **Kernel Panic** و **خطاهای سخت‌افزاری** (دیسک، حافظه).
    -   **مدیریت منابع:** تشخیص مشکلات کمبود حافظه (OOM Killer) که منجر به ناپایداری سرویس‌ها می‌شود.
    -   **رویدادهای سیستمی:** ثبت ری‌استارت‌های ناگهانی سرور.

-   **گزارش‌دهی هوشمند و با نمودار:**
    -   **داشبورد گرافیکی:** نمایش آمار حملات و مهاجمان برتر با استفاده از نمودارهای دایره‌ای و میله‌ای (Chart.js).
    -   **موقعیت‌یابی جغرافیایی (GeoIP):** نمایش کشور مهاجمان بر اساس آدرس IP.
    -   **هایلایت هوشمند:** مشخص کردن بخش خطرناک در هر لاگ با پس‌زمینه قرمز برای شناسایی سریع.
    -   **توضیحات آموزشی:** ارائه توضیحات ساده درباره ماهیت هر حمله در کنار لاگ مربوطه.

-   **سبک و قابل حمل:**
    -   **نصب آسان:** تنها با آپلود یک فایل PHP.
    -   **بدون نیاز به دیتابیس:** تمام پردازش‌ها به صورت آنی انجام می‌شود.

---

## 🚀 نصب و راه‌اندازی

نصب این ابزار بسیار ساده است، اما بسته به نوع هاست شما (اشتراکی یا سرور مجازی/اختصاصی) روش راه‌اندازی متفاوت است.

### سناریو ۱: استفاده در هاست اشتراکی (روش دستی)

در هاست اشتراکی به دلیل محدودیت‌های امنیتی، دسترسی مستقیمی به لاگ‌های سیستمی وجود ندارد. در این حالت، باید لاگ‌ها را به صورت دستی به اسکریپت بدهید.

1.  **آپلود اسکریپت:** فایل `log-analyzer.php` (یا هر نامی که برای آن انتخاب کرده‌اید) را روی هاست خود آپلود کنید.
2.  **دانلود لاگ‌ها:** از طریق کنترل پنل هاست خود (مانند cPanel)، به بخش **Raw Access Log** و **Error Log** بروید و لاگ‌های مربوط به سایت خود را دانلود کنید.
3.  **ایجاد فایل لاگ:** در کنار اسکریپت، یک فایل خالی به نام `access.log` بسازید.
4.  **تجمیع لاگ‌ها:** محتوای فایل‌های لاگی که دانلود کرده‌اید را در فایل `access.log` کپی کنید.
5.  **پیکربندی اسکریپت:** مطمئن شوید که آرایه `$logFiles` در ابتدای اسکریپت فقط شامل نام همین فایل باشد:
    ```php
    $logFiles = [
        'access.log',
    ];
    ```
6.  **مشاهده گزارش:** فایل PHP را در مرورگر خود باز کنید.

### سناریو ۲: استفاده در سرور مجازی یا اختصاصی (VPS/Dedicated - روش اتوماتیک)

در این حالت، شما می‌توانید از تمام پتانسیل ابزار برای خواندن خودکار لاگ‌های سیستمی استفاده کنید.

**پیش‌نیاز:** دسترسی به ترمینال سرور از طریق SSH با کاربر `root` یا `sudo`.

1.  **آپلود اسکریپت:** فایل اسکریپت را در مسیر دلخواه خود روی سرور آپلود کنید (مثلاً در یک ساب‌دامین مخصوص ابزارها).

2.  **پیکربندی مسیر لاگ‌ها:** اسکریپت را باز کرده و آرایه `$logFiles` را متناسب با سیستم‌عامل سرور خود ویرایش کنید. خطوط مربوطه را از حالت کامنت خارج کنید:
    ```php
    $logFiles = [
        // مثال برای سرور CentOS/RHEL
        '/var/log/httpd/access_log',
        '/var/log/httpd/error_log',
        '/var/log/secure',
        '/var/log/messages',
        // ... سایر مسیرها
    ];
    ```

3.  **تنظیم دسترسی‌ها (مهم‌ترین مرحله):** کاربر وب‌سرور شما (معمولاً `apache` در CentOS یا `www-data` در Ubuntu) باید اجازه خواندن این فایل‌ها را داشته باشد. دستورات زیر را از طریق SSH اجرا کنید:
    ```bash
    # مثال برای CentOS/RHEL
    sudo setfacl -m u:apache:r /var/log/messages /var/log/secure /var/log/maillog

    # مثال برای Debian/Ubuntu
    sudo setfacl -m u:www-data:r /var/log/syslog /var/log/auth.log /var/log/mail.log
    ```

4.  **🔒 امن‌سازی اسکریپت (بسیار حیاتی):**
    از آنجایی که این اسکریپت اطلاعات حساسی را نمایش می‌دهد، **باید** دسترسی به آن را با رمز عبور محدود کنید.
    -   یک فایل `.htaccess` در کنار اسکریپت خود ایجاد کنید و محتوای زیر را در آن قرار دهید (مسیر فایل رمز را اصلاح کنید):
        ```apache
        AuthType Basic
        AuthName "Admin Area"
        AuthUserFile /var/www/your-site/.htpasswd
        Require valid-user
        ```
    -   با دستور `htpasswd` یک فایل رمز عبور بسازید:
        ```bash
        htpasswd -c /var/www/your-site/.htpasswd your_username
        ```



این پروژه تحت لایسنس MIT منتشر شده است. برای اطلاعات بیشتر فایل `LICENSE` را مطالعه کنید.
